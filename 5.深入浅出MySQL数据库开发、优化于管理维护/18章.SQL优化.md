# 18章.SQL优化
## 18.1 优化SQL的一般步骤
### 18.1.1 通过shou status了解各类sql执行的频率
* 默认为global，数据库自启动来的统计
```sql
show [session|global]status
例如：
show status like "Com%"
```
* 其中Com_select表示select执行的次数，其他的一样，这些参数不区别引擎，就是说是所有殷勤的和，如果要特别表示innodb的可以使用如下参数：Innodb_rows_inserted(执行insert插入的行数),Innodb_rows_read(select 查询返回的行数)等
* 可以通过Com_commit和Com_rollback来观察事物提交情况
* Connections:试图连接MySQL服务器的次数，Uptime：服务器工作时间，Slow_queries：慢查询次数

### 18.1.2定位执行效率较低的SQL
* 查看慢查询日志，通过--log-slow-queries[=file_name]来启动时开启慢查询日志，会记录超过long_query_time秒的sql。
* 但是慢查询日志知会记录执行过的慢sql，在执行中的不能记录，所以可以使用show processlist查看执行中的sql的线程状态、是否锁表等。有super可以查看所有的线程，否则只能看自己的。
* show open table;可以查看那些表示打开的。In_use列表示多少线程正在使用这张表，Name_locked表示表名是否被锁，这一般发生早drop或者rename的时候。所以这条命令不能帮助解答我们常见的问题：当前某张表是否有死锁，谁拥有表上的这个锁等。
* show status like "%lock%";