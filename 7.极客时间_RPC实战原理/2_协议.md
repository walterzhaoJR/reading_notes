## 2_协议：怎么设计可扩展且向后兼容的协议？
* rpc的协议可以看做是类似于http协议的应用层协议
* 协议的作用：就想句子的标点一样，我们要从网络的二进制流中分割出真正是我们需要的数据，就像是需要一个边界，我们把这个边界就叫做协议。

#### 如何设计协议
* 为什么不直接使用HTTP协议？
    * 这还要从 RPC 的作用说起，相对于 HTTP 的用处，RPC 更多的是负责应用间的通信，所以性能要求相对更高。但 HTTP 协议的数据包大小相对请求数据本身要大很多，又需要加入很多无用的内容，比如换行符号、回车符等；还有一个更重要的原因是，HTTP 协议属于无状态协议，客户端无法对请求和响应进行关联，每次请求都需要重新建立连接，响应完成后再关闭连接。因此，对于要求高性能的 RPC 来说，HTTP 协议基本很难满足需求，所以 RPC 会选择设计更紧凑的私有协议。
* 如何设计一个私有的rpc协议
    * 要起到断句的作用就是要有一个固定的长度来保存请求数据的大小
    * 另外还要保存我们请求数据的一些编解码方式、id、具体的数据长度等标示信息，一般这些信息叫做协议头，一般长度固定。
    * 协议体一般保存请求的接口方法，请求参数等，一般是变长的。
* 可扩展的协议
    * 比如说，服务提供方收到一个过期请求，这个过期是说服务提供方收到的这个请求的时间大于调用方发送的时间和配置的超时时间，既然已经过期，就没有必要接着处理，直接返回一个超时就好了。那要实现这个功能，就要在协议里面传递这个配置的超时时间，那如果之前协议里面没有加超时时间参数的话，我们现在把这个超时时间加到协议体里面是不是就有点重了呢？显然，会加重 CPU 的消耗。
    * 其实协议的可扩展性就是协议头要做到可以扩展，那么可以在协议头中加一个固定的长度来表示协议头的长度，来标记协议头中的信息，这样我们就可以在协议头中再增加一些字段了。
* 总结
    * 在 RPC 里面，协议的作用就类似于文字中的符号，作为应用拆解请求消息的边界，保证二进制数据经过网络传输后，还能被正确地还原语义，避免调用方跟被调用方之间的“鸡同鸭讲”。